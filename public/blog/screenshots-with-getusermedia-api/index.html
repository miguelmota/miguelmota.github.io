<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>My New Hugo Site  | Screenshots with getUserMedia API</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.52" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Screenshots with getUserMedia API" />
<meta property="og:description" content="Take webcam screenshots with the getUserMedia JavaScript API." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/blog/screenshots-with-getusermedia-api/" /><meta property="article:published_time" content="2013-08-31T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2013-08-31T00:00:00&#43;00:00"/>

<meta itemprop="name" content="Screenshots with getUserMedia API">
<meta itemprop="description" content="Take webcam screenshots with the getUserMedia JavaScript API.">


<meta itemprop="datePublished" content="2013-08-31T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2013-08-31T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="924">



<meta itemprop="keywords" content="HTML5,JavaScript,getUserMedia,demo," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Screenshots with getUserMedia API"/>
<meta name="twitter:description" content="Take webcam screenshots with the getUserMedia JavaScript API."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://example.org/" class="f3 fw2 hover-white no-underline white-90 dib">
      My New Hugo Site
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        BLOGS
      </p>
      <h1 class="f1 athelas mb1">Screenshots with getUserMedia API</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2013-08-31T00:00:00Z">August 31, 2013</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<p>With the <code>getUserMedia</code> API, it is now possible to access the user&rsquo;s webcam and microphone using just JavaScript. What this means is that we can finally get rid of those nasty Flash plugins and use this native approace instead. At the writing of this post, only Firefox 17+ and Chrome 21+ have <a href="http://caniuse.com/stream">support for getUserMedia</a>.</p>

<p>Give credit where credit is due. The code is heavily inspired by HTML5 Rocks&rsquo; article <em><a href="http://www.html5rocks.com/en/tutorials/getusermedia/intro/">Capturing Audio &amp; Video in HTML5</a></em>.</p>

<p><a href="{{ .Site.BaseURL }}/demo">View the demo »</a></p>

<p>I tried explaining what the code does in the comments, but anyhow let me give a quick rundown of the code. First we create an object to hold everything that deals with the whole process of streaming and capturing. At the top, we grab our DOM elements and have an initialize function that checks for getUserMedia support. If there is support then call the gotStream function to start outputting the live stream into the video element. So that&rsquo;s that. There&rsquo;s a capture button binded to the capture method, which when called, will grab the current frame of the live video and draw that image onto the canvas element. We then turn the canvas image into a base 64 data url so that we can send it to our server, which will ultimately decode the data url and save it as a PNG image. Afterwards we simply return the saved image url. In the demo I am using PHP to decode the data url but any server side language will do I imagine.</p>

<pre><code class="language-html">&lt;!-- Video element (live stream) --&gt;
&lt;label&gt;Video Stream&lt;/label&gt;
&lt;video autoplay id=&quot;video&quot; width=&quot;640&quot; height=&quot;480&quot;&gt;&lt;/video&gt;

&lt;!-- Canvas element (screenshot) --&gt;
&lt;label&gt;Screenshot (base 64 dataURL)&lt;/label&gt;
&lt;canvas id=&quot;canvas&quot; width=&quot;640&quot; height=&quot;480&quot;&gt;&lt;/canvas&gt;

&lt;!-- Capture button --&gt;
&lt;button id=&quot;capture-btn&quot;&gt;Capture!&lt;/button&gt;

&lt;!-- Image URL output --&gt;
&lt;label&gt;Image URL&lt;/label&gt;
&lt;input type=&quot;text&quot; id=&quot;image-url-input&quot; disabled&gt;
</code></pre>

<pre><code class="language-javascript">(function() {

  // Our element ids.
  var options = {
    video: '#video',
    canvas: '#canvas',
    captureBtn: '#capture-btn',
    imageURLInput: '#image-url-input'
  };

  // Our object that will hold all of the functions.
  var App = {
    // Get the video element.
    video: document.querySelector(options.video),
    // Get the canvas element.
    canvas: document.querySelector(options.canvas),
    // Get the canvas context.
    ctx: canvas.getContext('2d'),
    // Get the capture button.
    captureBtn: document.querySelector(options.captureBtn),
    // This will hold the video stream.
    localMediaStream: null,
    // This will hold the screenshot base 64 data url.
    dataURL: null,
    // This will hold the converted PNG url.
    imageURL: null,
    // Get the input field to paste in the imageURL.
    imageURLInput: document.querySelector(options.imageURLInput),

    initialize: function() {
      var that = this;
      // Check if navigator object contains getUserMedia object.
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
      // Check if window contains URL object.
      window.URL = window.URL || window.webkitURL;

      // Check for getUserMedia support.
      if (navigator.getUserMedia) {
        // Get video stream.
        navigator.getUserMedia({
          video: true
        }, this.gotStream, this.noStream);

        // Bind capture button to capture method.
        this.captureBtn.onclick = function () {
          that.capture();
        };
      } else {
        // No getUserMedia support.
        alert('Your browser does not support getUserMedia API.');
      }
    },

    // Stream error.
    noStream: function (err) {
      alert('Could not get camera stream.');
            console.log('Error: ', err);
    },

    // Stream success.
    gotStream: function (stream) {
      // Feed webcam stream to video element.
      // IMPORTANT: video element needs autoplay attribute or it will be frozen at first frame.
      if (window.URL) {
        video.src = window.URL.createObjectURL(stream);
      } else {
        video.src = stream; // Opera support.
      }

      // Store the stream.
      localMediaStream = stream;
    },

    // Capture frame from live video stream.
    capture: function () {
      var that = this;
      // Check if has stream.
      if (localMediaStream) {
        // Draw whatever is in the video element on to the canvas.
        that.ctx.drawImage(video, 0, 0);
        // Create a data url from the canvas image.
        dataURL = canvas.toDataURL('image/png');
        // Call our method to save the data url to an image.
        that.saveDataUrlToImage();
       }
    },

    saveDataUrlToImage: function () {
      var that = this;
      var options = {
        // Change this to your own url.
        url: 'http://example.com/dataurltoimage'
      };

      // Only place where we need jQuery to make an ajax request
      // to our server to convert the dataURL to a PNG image,
      // and return the url of the converted image.
      that.imageURLInput.value = 'Fetching url ...';
      $.ajax({
        url: options.url,
        type: 'POST',
        dataType: 'json',
        data: { 'data_url': dataURL },
        complete: function(xhr, textStatus) {
        // Request complete.
        },
        // Request was successful.
        success: function(response, textStatus, xhr) {
          console.log('Response: ', response);
          // Conversion successful.
          if (response.status_code === 200) {
            imageURL = response.data.image_url;
            // Paste the PNG image url into the input field.
            that.imageURLInput.value = imageURL;
                                                that.imageURLInput.removeAttribute('disabled');
          }
        },
        error: function(xhr, textStatus, errorThrown) {
          // Some error occured.
          console.log('Error: ', errorThrown);
          imageURLInput.value = 'An error occured.';
        }
      });
    }

  };

  // Initialize our application.
  App.initialize();

  // Expose to window object for testing purposes.
  window.App = App;

})();
</code></pre>

<pre><code class="language-php">&lt;?php
  // Data URL to image.

  // exit immediately if the data url was not passed.
  if (!isset($_REQUEST['data_url'])) {
    exit();
  }

  // Get the data url.
  $img = $_REQUEST['data_url'];

  // Clean up the data url string a bit.
  $img = str_replace('data:image/png;base64,', '', $img);
  $img = str_replace(' ', '+', $img);

  // Decode the image.
  $decodedImage = base64_decode($img);

  // Generate a random filename.
  $filename = md5(time()).'.png';

  // Save the file to the server and generate a response.
  if (file_put_contents($_SERVER['DOCUMENT_ROOT'] . '/uploads/' . $filename, $decodedImage)) {
    $imageURL = 'http://' . $_SERVER['HTTP_HOST'] . '/uploads/' . $filename;
    $response = array(
      'status_code' =&gt; 200,
      'data' =&gt; array(
        'image_url' =&gt; $imageURL
      )
    );
  } else {
    $response = array(
      'status_code' =&gt; 500
    );
  }

  // Return JSON response.
  header(&quot;Content-Type: application/json&quot;);
  echo json_encode($response);
?&gt;
</code></pre>

<p>Get this <a href="https://gist.github.com/miguelmota/6403122">gist.</a></p>

<p><a href="{{ .Site.BaseURL }}/demo">View the demo »</a></p>

<h2 id="update-05-jan-2015">Update 05 Jan 2015</h2>

<p>Moved to a <a href="https://github.com/miguelmota/getUserMedia-demo">repo on Github</a>, with a <a href="http://nodejs.org/">Node.js</a> server instead of PHP.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/html5" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">HTML5</a>
   </li>
  
   <li class="list">
     <a href="/tags/javascript" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">JavaScript</a>
   </li>
  
   <li class="list">
     <a href="/tags/getusermedia" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">getUserMedia</a>
   </li>
  
   <li class="list">
     <a href="/tags/demo" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">demo</a>
   </li>
  
</ul>
<div class="mt6">
        
      </div>
    </section>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/blog/basic-html5-audio-manipulation/">Basic HTML5 Audio Manipulation</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/display-latest-delicious-bookmarks-with-jquery/">Display latest delicious bookmarks with jQuery</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/make-an-awesome-tooltip-with-jquery/">Make an Awesome Tooltip with jQuery</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/naive-bayes-classifier-in-javascript/">Naive Bayes Classifier in JavaScript</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/slide-out-navigation-using-css3-translate/">Slide Out Navigation using CSS3 Translate</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/call-and-apply-methods-in-javascript/">Call and Apply Methods in JavaScript</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/responsive-video/">Responsive Video</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/css3-filters/">CSS3 Filters</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/html5-reset-stylesheet/">HTML5 Reset Stylesheet</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/blog/bitwise-operators-in-javascript/">Bitwise operators in JavaScript</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://example.org/" >
    &copy; 2019 My New Hugo Site
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
