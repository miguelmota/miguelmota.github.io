<!DOCTYPE html>
<html lang="en-US" manifest="http://cache.miguelmota.com/cache.appcache">
<head>
	<meta charset="UTF-8">
	<!--
	                                      ___                           __
	           __                        /\_ \                         /\ \__
	  ___ ___ /\_\     __   __  __     __\//\ \         ___ ___     ___\ \ ,_\    __
	/' __` __`\/\ \  /'_ `\/\ \/\ \  /'__`\\ \ \      /' __` __`\  / __`\ \ \/  /'__`\
	/\ \/\ \/\ \ \ \/\ \L\ \ \ \_\ \/\  __/ \_\ \_    /\ \/\ \/\ \/\ \L\ \ \ \_/\ \L\.\_
	\ \_\ \_\ \_\ \_\ \____ \ \____/\ \____\/\____\   \ \_\ \_\ \_\ \____/\ \__\ \__/.\_\
	 \/_/\/_/\/_/\/_/\/___L\ \/___/  \/____/\/____/    \/_/\/_/\/_/\/___/  \/__/\/__/\/_/
	                   /\____/
	                   \_/__/
	-->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="description" content="Simple explanations of Redis data structures.">
	<meta name="keywords" content="miguel mota,web developer,html5 css3 javascript">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-title" content="Moogs">
	<title>Intro to Redis » Miguel Mota | Web Developer</title>
	<link rel="canonical" href="http://www.miguelmota.com/blog/intro-to-redis">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/miguelmota">
	<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/img/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144x144.png">
	<link rel="apple-touch-startup-image" media="(device-width: 320px)" href="/img/apple-touch-startup-image-320x460.png">
	<link rel="apple-touch-startup-image" media="(device-width: 320px) and (-webkit-device-pixel-ratio: 2)" href="/img/apple-touch-startup-image-640x920.png">
	<link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="/img/apple-touch-startup-image-640x1096.png">
	<link rel="apple-touch-startup-image" media="(device-width: 768px) and (orientation: portrait)" href="/img/apple-touch-startup-image-768x1004.png">
	<link rel="apple-touch-startup-image" media="(device-width: 768px) and (orientation: landscape)" href="/img/apple-touch-startup-image-748x1024.png">
	<link rel="apple-touch-startup-image" media="(device-width: 1536px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="/img/apple-touch-startup-image-1536x2008.png">
	<link rel="apple-touch-startup-image" media="(device-width: 1536px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="/img/apple-touch-startup-image-2048x1496.png">
	<link rel="stylesheet" href="/css/main.css">
	<script src="//use.typekit.net/wkl5rpy.js"></script>
	<script>try{Typekit.load();}catch(e){}</script>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  <script src="/js/main.min.js"></script>
	<script>
	  	var _gaq = _gaq || [];
	   	_gaq.push(['_setAccount', 'UA-12642068-1']);
	   	_gaq.push(['_setDomainName', '.miguelmota.com']);
	  	_gaq.push(['_trackPageview']);
	   	(function() {
	     		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	     		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	     		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	   	})();
	   	$(document).on('click', '[data-ga-label]', function() {
	   		_gaq.push(['_trackEvent', 'Call To Action', 'Click', $(this).attr('data-ga-label')]);
	   	});
	</script>
</head>
<body id="blog">
		<div id="top"></div>
		<img class="hidden" src="/img/miguel-mota-m-logo-500x500.png" alt="">

		<header id="header" class="contain-to-grid fixed">
			<nav class="top-bar">
				<ul class="title-area">
					<li class="name"><a href="/" data-ga-label="Navigation - Logo">Miguel Mota</a></li>
					<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
				</ul>
				<section class="top-bar-section">
				    <ul id="main-nav" class="right">
				      <li class="divider"></li>
				      <li ><a href="/" data-ga-label="Navigation - Home"><i class="icon-home"></i></a></li>
				      <li class="divider"></li>
				      <li ><a href="/about" data-ga-label="Navigation - About"><i class="icon-bookmark-empty"></i> About</a></li>
				      <li class="divider"></li>
				      <li class="active"><a href="/blog" data-ga-label="Navigation - Blog"><i class="icon-lightbulb"></i> Thoughts</a></li>
				      <li class="divider"></li>
				      <li ><a href="/work" data-ga-label="Navigation - Work"><i class="icon-laptop"></i> Work</a></li>
				      <li class="divider"></li>
							<li ><a href="/contact" data-ga-label="Navigation - Contact"><i class="icon-envelope"></i> Contact</a></li>
				      <li class="divider"></li>
				    </ul>
				</section>
			</nav>
		</header>

		<main id="main" role="main">
			<header id="content-header">
	<canvas id="canvas"></canvas>
	<div class="row">
		<div class="large-12 column">

			<datetime>23 Jan 2014 <small><i class="icon-comment-alt"></i> <a href="/blog/intro-to-redis#disqus_thread" data-disqus-identifier="/blog/intro-to-redis"></a></small> <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.miguelmota.com/blog/intro-to-redis" data-text="Intro to Redis" data-size="large" data-related="_moogs" data-ga-label="Blog post - Tweet">Tweet</a></datetime>
			<h1>Intro to Redis</h1>

		</div>
	</div>
	<div id="content-header-bottom">
		<div class="triangle"></div>
	</div>
</header>

<section id="post">
	<div class="row">
		<div class="large-12 column">

			<p><a href="http://redis.io/" target="_blank"><strong>Redis</strong></a> is an in-memory, key-value store that is fast. <em>Really fast</em>. Redis can hold hundreds of millions of keys in memory and handle tens of thousands of requests per second without breaking a sweat. It's useful for caching data, maintaining sessions, keeping counters, queues, publish/subscribe real time notifications, and so on. There are many use cases for Redis due to it's simple dictionary model that maps keys to values, but what one should be aware of is that it's focus is <em>not</em> long-term data persistance. The whole Redis database is loaded into memory so there is a chance of data loss due to the fact that Redis first stores new entries in memory and then writes it to disk in the background after a certain period of time or amount of new keys have been accumulated. For example, if there were to be a power failure you could potentially lose a minute or two worth of data, which can or may not be fatal depending on your application. Of course, you can configure the threshold to something more comfortable which I will go over later.</p>

<p>The majority of this post will be going over some of the data structures that Redis provides, such as <strong>keys</strong>, <strong>hashes</strong>, <strong>lists</strong>, and <strong>sets</strong>. Redis isn't meant to be an <em>all-in-one</em> database replacement. It has it's niche, it's simple and it can do certain <em>really</em> well. If you haven't already, I strongly suggest you read the <a href="http://redis.io/topics/data-types-intro" target="_blank">15 minute intro to Redis data types</a> on the Redis site. I'll also talk about sorting, multi-commands, and monitoring.</p>

<p>It would be wrong if I didn't give credit to <a href="http://openmymind.net/2012/1/23/The-Little-Redis-Book/" target="_blank">The Little Redis Book</a> by <a href="http://openmymind.net/" target="_blank">Karl Seguin</a> for helping me gain a lot of the information on Redis. It's definitely a good read and great resource.</p>

<h2>Installation</h2>

<p><a href="http://redis.io/topics/quickstart" target="_blank">The Redis quickstart guide</a> is good place to start. Installing Redis is straight forward. <a href="http://redis.io/download" target="_blank">Download</a> the tarball, extract, and run <code>make</code>. If you're on a Mac you can simply do <code>brew install redis</code> with <a href="http://brew.sh/" target="_blank">Homebrew</a>.

<p>After installation, start a redis instance with</p>

<div class="highlight"><pre><code class="bash">redis-server <span class="o">{</span>path to redis.conf<span class="o">}</span>
</code></pre></div>

<p>and then fire up the command line client</p>

<div class="highlight"><pre><code class="bash">redis-cli -p <span class="o">{</span>port<span class="o">}</span>
</code></pre></div>

<p>For the rest of the post we'll be working from the command-line interface.</p>

<h2>Keys</h2>

<p>Keys can hold a single value, wether it be a string or numeric value. We create a key with the <code>set</code> command</p>

<div class="highlight"><pre><code class="bash">&gt; <span class="nb">set </span>foo bar 
OK
</code></pre></div>

<p>Retreive a key with the <code>get</code> command</p>

<div class="highlight"><pre><code class="bash">&gt; get foo
<span class="s2">&quot;bar&quot;</span>
</code></pre></div>

<p>Delete a key with <code>del</code></p>

<div class="highlight"><pre><code class="bash">&gt; del foo
<span class="o">(</span>integer<span class="o">)</span> 1
&gt; get foo
<span class="o">(</span>nil<span class="o">)</span>
</code></pre></div>

<p>Store a JSON string</p>

<div class="highlight"><pre><code class="bash">&gt; <span class="nb">set </span>users:foo <span class="s2">&quot;{name: foo, age: 21, hobbies: [baz, qux]}&quot;</span>
OK
&gt; get users:foo
<span class="s2">&quot;{name: foo, age: 21, hobbies: [baz, qux]}&quot;</span>
</code></pre></div>

<p>Notice the colon in the key. The colon is just part of the key name, it doesn't have any special meaning to Redis. It's purpose is to visually group a set of related keys together.</p>

<p>If the value is a number you can incremented with the <code>incr</code > or <code>incrby</code> command. If the key doesn't exist it will simply create it</p>

<div class="highlight"><pre><code class="bash">&gt; incr stats:views  
<span class="o">(</span>integer<span class="o">)</span> 1
&gt; incr stats:views  
<span class="o">(</span>integer<span class="o">)</span> 2
&gt; incrby stats:views 5
<span class="o">(</span>integer<span class="o">)</span> 7
</code></pre></div>

<h2>Hashes</h2>

<p>Hashes are </p>

hmset users:goku race saiyan age 737
hmget users:goku race powerlevel
hgetall users:goku
hkeys users:goku
hdel users:goku age

<h2>Lists</h2>

lpush newusers goku
ltrim newusers 0 49 # get top 50

<h2>Sets</h2>

sadd friends:leto ghanima paul chani jessica
sadd friends:duncan paul jessica alia
sismember friends:leto jessica # true
sismember friends:leto vladimir # false
sinter friends:leto friends:duncan # return a list of shared friends
sinterstore friends:leto_duncan friends:leto friends:duncan # store result
# sorted sets
zadd friends:duncan 70 ghanima 95 paul 95 chani 75 jessica 1 vladimir # the number is rank
zcount friends:duncan 90 100 # count of top rank
zrevrank friends:duncan chani # get list rank. hight to low

# users
set users:9001 ”{id: 9001, email: leto@dune.gov, ...}”
hset users:lookup:email leto@dune.gov 9001
get users:9001
# ruby - get user by email
id = redis.hget(’users:lookup:email’, ’leto@dune.gov’)
user = redis.get(”users:#{id}”)

# sorting
rpush users:leto:guesses 5 9 10 2 4 10 19 2
sort users:leto:guesses
sadd friends:ghanima leto paul chani jessica alia duncan
sort friends:ghanima limit 0 3 desc alpha

# sort by severity example
sadd watch:leto 12339 1382 338 9338
set severity:12339 3
set severity:1382 2
set severity:338 5
set severity:9338 4
sort watch:leto by severity:* desc

# another example
hset bug:12339 severity 3
hset bug:12339 priority 1
hset bug:12339 details ”{id: 12339, ....}”
hset bug:1382 severity 2
hset bug:1382 priority 2
hset bug:1382 details ”{id: 1382, ....}”

sort watch:leto by bug:*->priority get bug:*->details
# store result
sort watch:leto by bug:*->priority get bug:*->details store watch_by_priority:leto


# scan
scan 0 match bugs:* count 2
> 1) ”3”
> 2) 1) ”bugs:125”
scan 3 match bugs:* count 2 # scan 3 because of previous next cursor
> 1) ”0” # 0 means end
> 2) 1) ”bugs:124”


# pipelining can really speed up a batch import
redis.pipelined do
9001.times do
redis.incr(’powerlevel’)
end

# queue - multi commands
multi
hincrby groups:1percent balance -9000000000
hincrby groups:99percent balance 9000000000
exec # or do 'discard'

# multi - in ruby
redis.watch(’powerlevel’)
current = redis.get(’powerlevel’)
redis.multi()
17
redis.set(’powerlevel’, current + 1)
redis.exec()

# don't use keys because it's slow
keys bug:1233:* # don't do this
# instead us hashes
hset bugs:1233 1 ”{id:1, account: 1233, subject: ’...’}”
hset bugs:1233 2 ”{id:2, account: 1233, subject: ’...’}”

# clear database
flushdb
# clear all databases
flushall

# select database
select 1

# expiration
expire pages:about 30 # 30 seconds
expireat pages:about 1356933600 # 12:00a.m. December 31st, 2012.
ttl pages:about # view time to live
persist pages:about # remove expiration

# subscribe
subscribe warnings # do this in one redis-cli window (can subscribe to multiple channels)
publish warnings ”it’s over 9000!” # do this in another window

# monitor
monitor
# recent logs
config set slowlog-log-slower-than 0
slowlog get
slowlog get 10
# everything related to loging
config get *log*

<h2>Conclusion</h2>


			<div class="tags">
				<i class="icon-tag"></i>
				
					<a href="/tag/redis">redis</a> <span>+</span>
				
			</div>

		</div>
	</div>

	
		<div id="related-posts" class="row">
			<div class="row">
				<div class="large-12 column">
					<div class="input-short-url">share: <input type="text" value="http://mig.gs/6XUE"></div>
				</div>
			</div>
			<div class="large-6 column">
				
    

    <h3>Previous post</h3>

	    <dl class="posts-list">

				<dt><datetime>30 Nov 2013</datetime></dt>
				<dd><h2><a href="/blog/getting-started-with-backbonejs">Getting Started with Backbone.js</a> <small><i class="icon-comment-alt"></i> <a href="/blog/getting-started-with-backbonejs#disqus_thread" data-disqus-identifier="/blog/getting-started-with-backbonejs"></a></small></h2></dd>

			</dl>

    



			</div>
			<div class="large-6 column">

				<h3>See also...</h3>

				<dl class="posts-list">
					
						<dt><datetime>30 Nov 2013</datetime></dt>
<dd><h2><a href="/blog/getting-started-with-backbonejs">Getting Started with Backbone.js</a> <small><i class="icon-comment-alt"></i> <a href="/blog/getting-started-with-backbonejs#disqus_thread" data-disqus-identifier="/blog/getting-started-with-backbonejs"></a></small></h2>
</dd>
					
						<dt><datetime>30 Oct 2013</datetime></dt>
<dd><h2><a href="/blog/memoization-caching-function-results-in-javascript">Memoization&#58; Caching function results in JavaScript</a> <small><i class="icon-comment-alt"></i> <a href="/blog/memoization-caching-function-results-in-javascript#disqus_thread" data-disqus-identifier="/blog/memoization-caching-function-results-in-javascript"></a></small></h2>
</dd>
					
						<dt><datetime>30 Sep 2013</datetime></dt>
<dd><h2><a href="/blog/set-up-ssh-keys">Set up SSH keys</a> <small><i class="icon-comment-alt"></i> <a href="/blog/set-up-ssh-keys#disqus_thread" data-disqus-identifier="/blog/set-up-ssh-keys"></a></small></h2>
</dd>
					
						<dt><datetime>26 Sep 2013</datetime></dt>
<dd><h2><a href="/blog/nodejs-and-ngnix-on-ubuntu">Node.js and Nginx on Ubuntu</a> <small><i class="icon-comment-alt"></i> <a href="/blog/nodejs-and-ngnix-on-ubuntu#disqus_thread" data-disqus-identifier="/blog/nodejs-and-ngnix-on-ubuntu"></a></small></h2>
</dd>
					
						<dt><datetime>25 Sep 2013</datetime></dt>
<dd><h2><a href="/blog/raspberry-pi-camera-board-video-streaming">Raspberry Pi camera board video streaming</a> <small><i class="icon-comment-alt"></i> <a href="/blog/raspberry-pi-camera-board-video-streaming#disqus_thread" data-disqus-identifier="/blog/raspberry-pi-camera-board-video-streaming"></a></small></h2>
</dd>
					
				</dl>

			</div>
		</div>
	

	<div id="comments" class="row">
		<div class="large-12 column">
			<div id="disqus_thread"></div>
		</div>
	</div>

</section>

<script>
    var disqus_shortname = 'miguelmota';
    var disqus_identifier = '/blog/intro-to-redis';
    var disqus_url = 'http://www.miguelmota.com/blog/intro-to-redis';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

		</main>

		<footer id="footer">
			<div class="row">
				<div class="large-12 column">
					<p>
						<span class="break"><span>© 2014 Moogs™, LLC.</span> <span>Made with <i class="icon-heart"></i></span></span> <a class="hidden" href="https://plus.google.com/102174577273194387652" rel="author">Google+</a>

						<a href="https://twitter.com/_moogs" class="twitter-follow-button" data-show-count="false" data-size="large" data-ga-label="Footer - Follow Twitter">Follow @_moogs</a>

					</p>
				</div>
			</div>
		</footer>

		<a id="forkme" href="https://github.com/miguelmota/miguelmota.github.com" target="_blank" data-ga-label="Fork me on Github"><img src="/img/forkme_right_darkblue_121621.png" alt=""></a>

		<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/src/infobox.js"></script>
	</body>
</html>
